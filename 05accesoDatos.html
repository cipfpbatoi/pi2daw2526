
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cipfpbatoi.github.io/pi2daw2526/05accesoDatos.html">
      
      
        <link rel="prev" href="sprint2.html">
      
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Annex I: Connexió a la base de dades - Projecte Intermodular 2DAW</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-X6D0LR7TC8"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-X6D0LR7TC8",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-X6D0LR7TC8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#desenvolupament-daplicacions-web-acces-a-dades" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="index.html" title="Projecte Intermodular 2DAW" class="md-header__button md-logo" aria-label="Projecte Intermodular 2DAW" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Projecte Intermodular 2DAW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Annex I: Connexió a la base de dades
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode nit"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canviar a mode nit" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Projecte Intermodular 2DAW" class="md-nav__button md-logo" aria-label="Projecte Intermodular 2DAW" data-md-component="logo">
      
  <img src="imagenes/logofp.png" alt="logo">

    </a>
    Projecte Intermodular 2DAW
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inici
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="projecte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enunciat
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="sprint1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iteració: Entorn, aparador i contacte
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="sprint2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iteració: Catàleg de productes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Annex I: Connexió a la base de dades
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="05accesoDatos.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Annex I: Connexió a la base de dades
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduccio-a-les-tecnologies-per-accedir-a-dades" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introducció a les tecnologies per accedir a dades
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Introducció a les tecnologies per accedir a dades">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bases-de-dades-relacionals-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Bases de dades relacionals (SQL)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bases-de-dades-nosql" class="md-nav__link">
    <span class="md-ellipsis">
      Bases de dades NoSQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acces-a-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Accés a APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-scraping" class="md-nav__link">
    <span class="md-ellipsis">
      Web Scraping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consideracions-de-seguretat" class="md-nav__link">
    <span class="md-ellipsis">
      Consideracions de seguretat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-bases-de-dades-relacionals-sql" class="md-nav__link">
    <span class="md-ellipsis">
      2. Bases de dades relacionals (SQL)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Bases de dades relacionals (SQL)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installacio" class="md-nav__link">
    <span class="md-ellipsis">
      Instal·lació
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estructura-duna-base-de-dades" class="md-nav__link">
    <span class="md-ellipsis">
      Estructura d'una base de dades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phpmyadmin" class="md-nav__link">
    <span class="md-ellipsis">
      phpMyAdmin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-php-data-objects-pdo" class="md-nav__link">
    <span class="md-ellipsis">
      3. PHP Data Objects :: PDO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. PHP Data Objects :: PDO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#constructor-de-la-classe-pdo" class="md-nav__link">
    <span class="md-ellipsis">
      Constructor de la classe PDO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fitxer-de-configuracio-de-la-bd" class="md-nav__link">
    <span class="md-ellipsis">
      Fitxer de configuració de la BD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentencies-preparades" class="md-nav__link">
    <span class="md-ellipsis">
      Sentències preparades
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemple-parametros" class="md-nav__link">
    <span class="md-ellipsis">
      Exemple paràmetros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemple-bindparam" class="md-nav__link">
    <span class="md-ellipsis">
      Exemple bindParam
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bindparam-vs-bindvalue" class="md-nav__link">
    <span class="md-ellipsis">
      bindParam VS bindValue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inserint-registres" class="md-nav__link">
    <span class="md-ellipsis">
      Inserint registres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultant-registres" class="md-nav__link">
    <span class="md-ellipsis">
      Consultant registres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultes-amb-models" class="md-nav__link">
    <span class="md-ellipsis">
      Consultes amb models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultes-amb-like" class="md-nav__link">
    <span class="md-ellipsis">
      Consultes amb LIKE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-login-password" class="md-nav__link">
    <span class="md-ellipsis">
      4. Login &amp; Password
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-exercisis" class="md-nav__link">
    <span class="md-ellipsis">
      5. Exercisis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Exercisis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bateria-dexercicis-solucionats" class="md-nav__link">
    <span class="md-ellipsis">
      Bateria d'exercicis solucionats
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="desenvolupament-daplicacions-web-acces-a-dades">Desenvolupament d'aplicacions web: Accés a Dades.<a class="headerlink" href="#desenvolupament-daplicacions-web-acces-a-dades" title="Permanent link">&para;</a></h1>
<h2 id="1-introduccio-a-les-tecnologies-per-accedir-a-dades">1. Introducció a les tecnologies per accedir a dades<a class="headerlink" href="#1-introduccio-a-les-tecnologies-per-accedir-a-dades" title="Permanent link">&para;</a></h2>
<h3 id="bases-de-dades-relacionals-sql">Bases de dades relacionals (SQL)<a class="headerlink" href="#bases-de-dades-relacionals-sql" title="Permanent link">&para;</a></h3>
<p>Les bases de dades relacionals utilitzen llenguatge SQL per emmagatzemar i recuperar dades de taules relacionades. En PHP, les tecnologies més utilitzades per accedir-hi són <strong>PDO</strong> i <strong>MySQLi</strong>. <strong>PDO</strong> suporta múltiples sistemes de bases de dades (MySQL, PostgreSQL, etc.), mentre que <strong>MySQLi</strong> està dissenyat específicament per a MySQL.</p>
<h3 id="bases-de-dades-nosql">Bases de dades NoSQL<a class="headerlink" href="#bases-de-dades-nosql" title="Permanent link">&para;</a></h3>
<p>Les bases de dades NoSQL, com <strong>MongoDB</strong> o <strong>Firebase</strong>, emmagatzemen dades en formats no estructurats, com JSON. Aquestes són ideals per a aplicacions que gestionen grans volums de dades o dades no estructurades. <strong>MongoDB</strong> és un sistema orientat a documents, mentre que <strong>Firebase</strong> és conegut per les seves capacitats en temps real.</p>
<h3 id="acces-a-apis">Accés a APIs<a class="headerlink" href="#acces-a-apis" title="Permanent link">&para;</a></h3>
<p>Les <strong>APIs REST</strong> permeten accedir a dades de serveis web externs utilitzant sol·licituds HTTP i respostes en formats com JSON o XML. <strong>GraphQL</strong> és una alternativa moderna que permet sol·licituds més específiques, només retornant les dades necessàries, en contrast amb les sol·licituds REST, que poden ser més generals.</p>
<h3 id="web-scraping">Web Scraping<a class="headerlink" href="#web-scraping" title="Permanent link">&para;</a></h3>
<p>El <strong>web scraping</strong> és el procés d'extracció automàtica de dades de pàgines web. Aquesta tècnica es pot utilitzar per recuperar informació d'una pàgina web quan no hi ha una API disponible. En PHP, es poden utilitzar diverses biblioteques per descarregar i analitzar contingut HTML, com ara <strong>cURL</strong> i <strong>DOMDocument</strong>.</p>
<h3 id="consideracions-de-seguretat">Consideracions de seguretat<a class="headerlink" href="#consideracions-de-seguretat" title="Permanent link">&para;</a></h3>
<p>És fonamental garantir la seguretat quan es treballa amb l'accés a dades. Això inclou protegir les aplicacions contra vulnerabilitats comunes, com les <strong>injeccions SQL</strong>, i assegurar les connexions utilitzant <strong>SSL/TLS</strong> quan es comuniqui amb bases de dades remotes o APIs externes.</p>
<h2 id="2-bases-de-dades-relacionals-sql">2. Bases de dades relacionals (SQL)<a class="headerlink" href="#2-bases-de-dades-relacionals-sql" title="Permanent link">&para;</a></h2>
<h3 id="installacio">Instal·lació<a class="headerlink" href="#installacio" title="Permanent link">&para;</a></h3>
<p>A través de <strong>XAMPP</strong> és molt senzill, simplement ens descarregaríem el programa i l'activaríem. Per a descarregar XAMPP <a href="https://www.apachefriends.org/es/download.html">prem ací</a>.</p>
<p>Amb <strong><em>Docker</em></strong> utilitzarem un altre  repositori que inclou el mysql i el phpMyAdmin i llancem
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div></p>
<p>Si tot ha eixit bé i el contenidor està en marxa, podrem visitar la pàgina de phpMyAdmin de la següent manera
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>http://localhost:8000
</code></pre></div></p>
<p>Per a accedir hem d'utilitzar les següents credencials que venen configurades en el arxiu <code>docker-compose.yml</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>usuario: root
<span class="linenos" data-linenos="2 "></span>contraseña: 1234
</code></pre></div>
<h3 id="estructura-duna-base-de-dades">Estructura d'una base de dades<a class="headerlink" href="#estructura-duna-base-de-dades" title="Permanent link">&para;</a></h3>
<p>Sabem que una base de dades té molts camps amb els seus noms i valors, però a més sabem que la base de dades ha de tindre un nom. per tant tindríem la següent estructura per a una base de dades:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>NombreBaseDeDatos
<span class="linenos" data-linenos=" 2 "></span>    |__Tabla-#1
<span class="linenos" data-linenos=" 3 "></span>    |       |__DatosTabla-#1
<span class="linenos" data-linenos=" 4 "></span>    |
<span class="linenos" data-linenos=" 5 "></span>    |__Tabla-#2
<span class="linenos" data-linenos=" 6 "></span>    |       |__DatosTabla-#2
<span class="linenos" data-linenos=" 7 "></span>    |
<span class="linenos" data-linenos=" 8 "></span>    |__Tabla-#3
<span class="linenos" data-linenos=" 9 "></span>    |       |__DatosTabla-#3
<span class="linenos" data-linenos="10 "></span>    [...]
</code></pre></div>
<p>Vegem-ho en un exemple real</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>Ryanair
<span class="linenos" data-linenos=" 2 "></span>    |__pasajero
<span class="linenos" data-linenos=" 3 "></span>    |    |__id[*]
<span class="linenos" data-linenos=" 4 "></span>    |    |__nombre
<span class="linenos" data-linenos=" 5 "></span>    |    |__apellidos
<span class="linenos" data-linenos=" 6 "></span>    |    |__edad
<span class="linenos" data-linenos=" 7 "></span>    |    |__id_vuelo[^]
<span class="linenos" data-linenos=" 8 "></span>    |
<span class="linenos" data-linenos=" 9 "></span>    |__vuelo
<span class="linenos" data-linenos="10 "></span>    |    |__id[*]
<span class="linenos" data-linenos="11 "></span>    |    |__n_plazas
<span class="linenos" data-linenos="12 "></span>    |    |__disponible
<span class="linenos" data-linenos="13 "></span>    |    |__id_pais[^]
<span class="linenos" data-linenos="14 "></span>    |
<span class="linenos" data-linenos="15 "></span>    |__pais
<span class="linenos" data-linenos="16 "></span>         |__id[*]
<span class="linenos" data-linenos="17 "></span>         |__nombre
</code></pre></div>
<div class="leyenda">
    [*] Clau primària [^] Clave Forània
</div>

<h3 id="sql">SQL<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h3>
<p>Aquest llenguatge de consulta estructurada (<em>Structured Query Language</em>) és el que utilitzarem per a realitzar les consultes a les nostres bases de dades per a mostrar el contingut en les diferents interfícies web que creem al llarg de la unitat. Si vols saber més detalls visita <a href="https://es.wikipedia.org/wiki/sql">Wiki SQL</a></p>
<p>Exemple d'una sentència SQL on seleccionem totes les files i columnes de la nostra taula anomenada <strong>'pais'</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pais</span>
</code></pre></div>
<p>Estas sentencias pueden invocarse desde la consola de comandos mediante el intérprete <em>mysql</em> (previamente instalado en el sistema) o a través de la herramienta phpMyAdmin.</p>
<p>Las sentencias SQL también las podemos usar dentro de nuestro código php, de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="c1">// Llistat de clients, adreçats per DNI de manera ASCendent</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$clientesOrdenadosPorDNI</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM `pasajero` ORDER BY `dni`&quot;</span> <span class="nx">ASC</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="cp">?&gt;</span>
</code></pre></div>
<h3 id="phpmyadmin">phpMyAdmin<a class="headerlink" href="#phpmyadmin" title="Permanent link">&para;</a></h3>
<p>Aquest programari funciona sota Ngingx i PHP i és més que res una interfície web per a gestionar les bases de dades que tinguem disponibles en el nostre servidor local. Molts *<em>hostings</em> ofereixen aquesta eina per defecte per a poder gestionar les BBDD que tinguem configurades sota el nostre compte.</p>
<h4 id="creant-una-base-de-dades-dins-de-phpmyadmin">Creant una base de dades dins de phpMyAdmin<a class="headerlink" href="#creant-una-base-de-dades-dins-de-phpmyadmin" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Per a crear una nova base de dades hem d'entrar en <em>phpMyAdmin</em> com a <em>usuari root</em> i punxar en l'opció <span class="warning"><em>Nova</em></span> del menú de l'esquerra.</p>
</li>
<li>
<p>En la nova finestra de creació posarem un <strong>nom</strong> a nostra <em>bbdd</em>.</p>
</li>
<li>
<p>També establirem el <strong>cotejamiento</strong> <span class="warning"><em>utf8m4_unicode_ci</em></span> perquè nostra <em>bbdd</em> suporte tot tipus de caràcters (com els asiàtics) i fins i tot <em>emojis</em> ;)</p>
</li>
<li>
<p>Li donem al botó de <strong>Crear</strong> per a crear la <em>bbdd</em> i començar a escriure les diferents taules que anem a introduir en ella.</p>
</li>
</ol>
<p>El sistema generarà el codi SQL per a crear tot el que li hem posat i crearà la base de dades amb les taules que li hàgem ficat.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">persona</span><span class="o">`</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">nombre</span><span class="o">`</span><span class="w"> </span><span class="n">TINYTEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">apellidos</span><span class="o">`</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">telefono</span><span class="o">`</span><span class="w"> </span><span class="n">TINYTEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="opcions-en-phpmyadmin">Opcions en phpMyAdmin<a class="headerlink" href="#opcions-en-phpmyadmin" title="Permanent link">&para;</a></h4>
<p>Quan seleccionem una base de dades de la llista, el sistema ens mostra diverses pestanyes amb les quals interactuar amb la base de dades en qüestió:</p>
<ul>
<li>
<p><code>Estructura</code>: Podem veure les diferents taules que consoliden la nostra base de dades</p>
</li>
<li>
<p><code>SQL</code>: Per si volem injectar codi SQL perquè el sistema l'interprete</p>
</li>
<li>
<p><code>Buscar</code>: Serveix per a buscar per termes, en la nostra base de dades, aplicant diferents filtres de cerca</p>
</li>
<li>
<p><code>Generar consulta</code>: semblança a SQL però d'una manera més gràfica, sense haver de saber res del llenguatge</p>
</li>
<li>
<p><code>Exportar i importar</code>: Com el seu nom indica, per a fer qualsevol de les 2 operacions sobre la base de dades</p>
</li>
<li>
<p><code>Operacions</code>: Diferents opcions avançades per a realitzar en la nostra base de dades, de la qual destacarem l'opció <em>Cotejamiento</em> on podrem canviar el <em>cotejamiento</em> de la nostra taula però <span class="alert"><em>ULL AMB ACÔ</em> perquè podem eliminar dades sense voler, ja que en canviar el <em>cotejamiento</em> podem suprimir caràcters no suportats pel nou <em>cotejamiento</em></span></p>
</li>
</ul>
<p>No aprofundirem en la resta d'opcions però, en la pestanya <strong>Més</strong> existeix l'opció <strong>Dissenyador</strong> per a poder editar les relacions entre taules d'una manera gràfica (punxant i arrossegant) que veurem més endavant.</p>
<h2 id="3-php-data-objects-pdo">3. PHP Data Objects :: PDO<a class="headerlink" href="#3-php-data-objects-pdo" title="Permanent link">&para;</a></h2>
<p>La classe PDO de PHP s'utilitza per connectar-se a una base de dades i executar consultes SQL de manera segura. Quan construeixes una instància de PDO, pots passar-li diferents atributs en el constructor i opcions per configurar el comportament de la connexió. Aquí tens els atributs principals i el seu propòsit:</p>
<h3 id="constructor-de-la-classe-pdo">Constructor de la classe PDO<a class="headerlink" href="#constructor-de-la-classe-pdo" title="Permanent link">&para;</a></h3>
<p>El constructor de la classe PDO accepta tres paràmetres obligatoris i un opcional:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$dsn</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$username</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$password</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>$dsn (Data Source Name): És una cadena que especifica el tipus de base de dades i la informació necessària per connectar-s'hi.</li>
<li>Format per tipus de base de dades i configuració, per exemple:<ul>
<li>Mysql:host=localhost;dbname=testdb (per a MySQL).</li>
<li>pgsql:host=localhost;port=5432;dbname=testdb (per a PostgreSQL).</li>
<li>sqlite:/path/to/database.db (per a SQLite).</li>
</ul>
</li>
<li>$username: El nom d'usuari per a la connexió a la base de dades.</li>
<li>$password: La contrasenya associada al nom d'usuari.</li>
<li>$options (Opcional): Un array d'opcions per definir el comportament de la connexió. Aquests són alguns dels valors més comuns que es poden definir en aquest array:<ul>
<li>PDO::ATTR_ERRMODE: Controla com es gestionen els errors. Alguns valors comuns són:</li>
<li>PDO::ERRMODE_SILENT: Els errors no generen cap missatge.</li>
<li>PDO::ERRMODE_WARNING: Els errors generen un avís.</li>
<li>PDO::ERRMODE_EXCEPTION: Els errors generen una excepció, que és el més recomanable per controlar errors.</li>
<li>PDO::ATTR_DEFAULT_FETCH_MODE: Defineix el mode de recuperació de dades per defecte, com ara:</li>
<li>PDO::FETCH_ASSOC: Retorna les dades com un array associatiu.</li>
<li>PDO::FETCH_OBJ: Retorna les dades com un objecte.</li>
<li>PDO::FETCH_BOTH: Retorna les dades com un array associatiu i numèric.</li>
<li>PDO::ATTR_PERSISTENT: Habilita connexions persistents. Una connexió persistent pot millorar el rendiment mantenint la connexió activa per múltiples peticions en lloc de crear-ne una nova cada vegada.</li>
<li>PDO::ATTR_TIMEOUT: Defineix un temps límit per a la connexió en segons.</li>
</ul>
</li>
</ul>
<h5 id="exemple-de-connexio-amb-pdo">Exemple de connexió amb PDO<a class="headerlink" href="#exemple-de-connexio-amb-pdo" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$dsn = &quot;mysql:host=localhost;dbname=testdb&quot;;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">$username = &quot;usuari&quot;;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">$password = &quot;contrasenya&quot;;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">$options = [</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    PDO::ATTR_PERSISTENT =&gt; true,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    PDO::MYSQL_ATTR_INIT_COMMAND =&gt; &quot;SET NAMES utf8&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">];</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">try {</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    $pdo = new PDO($dsn, $username, $password, $options);</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    echo &quot;Connexió establerta amb èxit!&quot;;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">} catch (PDOException $e) {</span>
<span class="linenos" data-linenos="15 "></span><span class="x">    echo &quot;Error de connexió: &quot; . $e-&gt;getMessage();</span>
<span class="linenos" data-linenos="16 "></span><span class="x">}</span>
</code></pre></div>
<p>Aquest codi estableix una connexió a una base de dades MySQL amb un joc de caràcters utf8, una connexió persistent, i llança excepcions en cas d'errors.</p>
<p>Qualsevol error que es llance a través de <strong>PDO</strong>, el sistema llançarà una  <strong>PDOException</strong> .</p>
<h3 id="fitxer-de-configuracio-de-la-bd">Fitxer de configuració de la BD<a class="headerlink" href="#fitxer-de-configuracio-de-la-bd" title="Permanent link">&para;</a></h3>
<p>De la mateixa manera que podem tenir el nostre arxiu de funcions <code>funciones.php</code> i alberguem totes les funcions que s'usen de manera global en l'aplicació, podem establir un arxiu de constants on definim els paràmetres de connexió amb la base de dades.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ conexion.php ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nx">constDSN</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=localhost;dbname=dwes&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nx">constUSUARIO</span> <span class="o">=</span> <span class="s2">&quot;dwes&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nx">constPASSWORD</span> <span class="o">=</span> <span class="s2">&quot;abc123&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="cm">/*  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="cm">        ▒▒▒▒▒▒▒▒ NO SUBAS ESTE ARCHIVO A git ▒▒▒▒▒</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span><span class="cm">        ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ */</span>
</code></pre></div></p>
<p>Aquest arxiu conté informació <span class="alert"><strong>molt sensible</strong></span> així que no és recomanable que puges aquest arxiu a <strong>git</strong>.</p>
<h3 id="sentencies-preparades">Sentències preparades<a class="headerlink" href="#sentencies-preparades" title="Permanent link">&para;</a></h3>
<p>Es tracta de sentències que s'estableixen com si foren plantilles de la SQL que llançarem, acceptant paràmetres que són establits a posteriori de la declaració de la sentència preparada.</p>
<p>Les sentències preparades eviten la <strong>injecció</strong> de SQL (SQL Injection) i milloren el rendiment de nostres <em>aplicacions</em> o pàgines web.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO Clientes VALUES (?, ?, ?, ?)&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Cada interrogant és un paràmetre que establirem després, unes quantes línies més a baix.</p>
<p>Una vegada tenim la plantilla de la nostra consulta, hem de seguir amb la preparació juntament amb 3 mètodes més de <strong>PHP</strong> per a la seua completa execució:</p>
<ul>
<li><code>prepare:</code> prepara la <strong>sentencia</strong> abans de ser executada.</li>
<li><code>bind</code>: el tipus d'unió (*<em>bind</em>^) de dada que pot ser mitjançant ' ? ' o ' :parametre '</li>
<li><code>execute</code> s'executa la consulta unint la plantilla amb les <em>variables</em> o paràmetres que hem establit.</li>
</ul>
<h3 id="exemple-parametros">Exemple paràmetros<a class="headerlink" href="#exemple-parametros" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">try</span> <span class="p">{</span> 
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cantidad&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM stock WHERE unidades = ?&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="nv">$cantidad</span><span class="p">]);</span>
<span class="linenos" data-linenos="18 "></span>        <span class="nv">$cantidadAfectada</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">rowCount</span><span class="p">();</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>        <span class="k">echo</span> <span class="nv">$cantidadAfectada</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span>
</code></pre></div>
<h3 id="exemple-bindparam">Exemple bindParam<a class="headerlink" href="#exemple-bindparam" title="Permanent link">&para;</a></h3>
<p>Molt semblant a utilitzar paràmetres però aquesta vegada la variable està dins de la sentència SQL, en aquest cas l'hem anomenada <code>:cant</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$conexion</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cantidad&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM stock WHERE unidades = :cant&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>        <span class="nv">$cantidadAfectada</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">rowCount</span><span class="p">();</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>        <span class="k">echo</span> <span class="nv">$cantidadAfectada</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div>
<h3 id="bindparam-vs-bindvalue">bindParam VS bindValue<a class="headerlink" href="#bindparam-vs-bindvalue" title="Permanent link">&para;</a></h3>
<p>Utilitzarem <code>bindValue()</code> quan hàgem d'inserir dades només una vegada, en canvi, haurem d'usar <code>bindParam()</code> quan hàgem de passar dades múltiples, com per exemple, un <em>array</em>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">// se asignan nombre a los parámetros</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM stock WHERE unidades = :cant&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="c1">// bindParam enlaza por referencia</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="c1">// se eliminan con cant = 1</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="c1">// bindValue enlaza por valor</span>
<span class="linenos" data-linenos="16 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>    <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>    <span class="c1">// se eliminan con cant = 0</span>
<span class="linenos" data-linenos="22 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</code></pre></div>
<p>Per a més informació i ús de les variables <em>PDO</em> <a href="https://www.php.net/manual/es/pdo.constants.php">consulta el manual de PHP</a>.</p>
<h3 id="inserint-registres">Inserint registres<a class="headerlink" href="#inserint-registres" title="Permanent link">&para;</a></h3>
<p>A l'hora d'inserir registres en una base de dades, hem de tindre en compte que en la taula pot haver-hi valors autoincrementats. Per a salvaguardar açò, el que hem de fer és deixar aqueix camp autoincrementat buit, però a l'hora de fer la connexió, hem de recuperar-ho amb el mètode <code>lastInsertId()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="nv">$nombre</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;nombre&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;SUCURSAL X&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$telefono</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;telefono&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;636123456&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;INSERT INTO tienda(nombre, tlf) VALUES (:nombre, :telefono)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:nombre&quot;</span><span class="p">,</span> <span class="nv">$nombre</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:telefono&quot;</span><span class="p">,</span> <span class="nv">$telefono</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>    <span class="nv">$idGenerado</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">lastInsertId</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">echo</span> <span class="nv">$idGenerado</span><span class="p">;</span>
</code></pre></div>
<h3 id="consultant-registres">Consultant registres<a class="headerlink" href="#consultant-registres" title="Permanent link">&para;</a></h3>
<p>A l'hora de recuperar els resultats d'una consulta, bastarà amb invocar al mètode <code>PDOStatement::fetch</code> per a llistar les files generades per la consulta.</p>
<p>Però hem de triar el tipus de dada que volem rebre entre els 3 que hi ha disponibles:</p>
<ul>
<li><code>PDO::FETCH_ASSOC:</code> array indexat que els seus keys són el nom de les columnes.</li>
<li><code>PDO::FETCH_NUM:</code> array indexat que els seus keys són números.</li>
<li><code>PDO::FETCH_BOTH:</code> valor per defecte. Retorna un array indexat que els seus keys són tant el nom de les columnes com números.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ consulta con array asociativo.php ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">try</span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;select * from tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>        <span class="k">while</span><span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">()){</span>
<span class="linenos" data-linenos="19 "></span>            <span class="k">echo</span> <span class="s2">&quot;Codigo:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;cod&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="20 "></span>            <span class="k">echo</span> <span class="s2">&quot;Nombre:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;nombre&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="21 "></span>            <span class="k">echo</span> <span class="s2">&quot;Teléfono:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;tlf&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="22 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span>    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div>
<p>Recuperant dades amb una matriu com a resultat de la nostra consulta</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ consulta con array asociativo ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$tiendas</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="k">foreach</span><span class="p">(</span><span class="nv">$tiendasas$tienda</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span><span class="s2">&quot;Codigo:&quot;</span> <span class="o">.</span> <span class="nv">$tienda</span><span class="p">[</span><span class="s2">&quot;cod&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span><span class="s2">&quot;Nombre:&quot;</span> <span class="o">.</span> <span class="nv">$tienda</span><span class="p">[</span><span class="s2">&quot;nombre&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
</code></pre></div>
Però si el que volem és llegir dades amb forma d'objecte utilitzant <code>PDO::FETCH_OBJ</code>, hem de crear un objecte amb propietats públiques amb el mateix nom que les columnes de la taula que anem a consultar.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ consulta con formato de objeto ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_OBJ</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">while</span><span class="p">(</span><span class="nv">$t</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span><span class="s2">&quot;Codigo:&quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">cod</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">echo</span><span class="s2">&quot;Nombre:&quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">nombre</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span><span class="s2">&quot;Teléfono:&quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">tlf</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
</code></pre></div>
<h3 id="consultes-amb-models">Consultes amb models<a class="headerlink" href="#consultes-amb-models" title="Permanent link">&para;</a></h3>
<p>Portem temps creant classes en PHP i les consultes també admeten aquest tipus de dades mitjançant l'ús de <code>PDO::FETCH_CLASS</code></p>
<p>Si usem aquest mètode, hem de tindre en compte que els noms dels atributs privats han de coincidir amb els noms de les columnes de la taula que anem a manejar.</p>
<p>Així doncs, si pel que siga canviem l'estructura de la taula <span class="alert"><strong>HEM DE CANVIAR</strong></span> la nostra classe perquè tot continue funcionant.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ clase Tienda ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nx">classTienda</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">private</span> <span class="nx">int</span> <span class="nv">$cod</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="k">private</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">private</span> <span class="o">?</span> <span class="nx">string</span> <span class="nv">$tlf</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getCodigo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>            <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">cod</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getNombre</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>            <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">nombre</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getTelefono</span><span class="p">()</span> <span class="o">:</span> <span class="o">?</span><span class="nx">string</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>            <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">tlf</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Consultando a través de la clase Tienda ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="c1">// Aquí &#39;Tienda&#39; es el nombre de nuestra clase</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span><span class="p">,</span> <span class="nx">Tienda</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">while</span><span class="p">(</span><span class="nv">$t</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">echo</span> <span class="s2">&quot;Codigo: &quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">getCodigo</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span> <span class="s2">&quot;Nombre: &quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">getNombre</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span> <span class="s2">&quot;Teléfono: &quot;</span> <span class="o">.</span> <span class="nv">$t</span> <span class="o">-&gt;</span> <span class="na">getTelefono</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
</code></pre></div>
<p>Però què passa si les nostres classes tenen constructor? doncs que hem d'indicar-li, al mètode FECTH, que emplene les propietats després de cridar al constructor i per a això fem ús de <code>PDO::FETCH_PROPS_LATE</code>.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Consulta para una clase con constructor ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tienda&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span> <span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="nx">Tienda</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="nv">$tiendas</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
</code></pre></div></p>
<h3 id="consultes-amb-like">Consultes amb LIKE<a class="headerlink" href="#consultes-amb-like" title="Permanent link">&para;</a></h3>
<p>Per a utilitzar el comodí <em>LIKE</em> o altres comodins, hem d'associar-lo a la dada i MAI en la pròpia consulta.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Utilizando comodines :: LIKE ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tienda where nombre like :nombre or tlf like :tlf&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span> <span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="nx">Tienda</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$cadBuscar</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">.</span> <span class="nv">$busqueda</span> <span class="o">.</span> <span class="s2">&quot;%&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="s2">&quot;nombre&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cadBuscar</span><span class="p">,</span><span class="s2">&quot;tlf&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cadBuscar</span><span class="p">]);</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
</code></pre></div>
<p>Teniu una llista d'exemples molt completa en la <a href="https://phpdelusions.net/pdo/objects">documentació oficial</a>.</p>
<h2 id="4-login-password">4. Login &amp; Password<a class="headerlink" href="#4-login-password" title="Permanent link">&para;</a></h2>
<p>Per a manejar un sistema complet de login i password amb contrasenyes xifrades, necessitem un mètode que xifre aqueixos <em>strings</em> que l'usuari introdueix com a contrasenya; tant en el formulari de registre com en el del <em>login</em>, ja que en codificar una contrasenya, després hem de descodificar-la per a comprovar que totes dues *contrasenyes (la que introdueix l'usuari en el login i la que tenim en la base de dades) coincidisquen.</p>
<p>Necessitem doncs:</p>
<ul>
<li><code>password_hash()</code> per a emmagatzemar la contrasenya en la base de dades a l'hora de fer el <em>INSERT</em></li>
<li>
<p><code>PASSWORD_DEFAULT</code> emmagatzemem la contrasenya usant el mètode d'encriptació bcrypt</p>
</li>
<li>
<p><code>PASSWORD_BCRYPT</code> emmagatzemem la contrasenya usant l'algorisme CRYPT_BLOWFISH compatible amb crypt()</p>
</li>
<li>
<p><code>password_verify()</code> per a verificar l'usuari i la contrasenya</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Almacenando usuario y password en BD ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$usu</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;usuario&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$pas</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO usuarios(usuario, password) VALUES (:usuario, :password)&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span>
<span class="linenos" data-linenos="12 "></span>        <span class="s2">&quot;usuario&quot;</span> <span class="o">=&gt;</span> <span class="nv">$usu</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span>        <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$pas</span><span class="p">,</span><span class="nx">PASSWORD_DEFAULT</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">]);</span>
</code></pre></div>
<p>Ara que tenim l'usuari codificat i guardat en la base de dades, el recuperarem per a poder loguejar-lo correctament.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="c1">//  ▒▒▒▒▒▒▒▒ Recuperando usuario y password en BD ▒▒▒▒▒▒▒▒</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$usu</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;select * from usuarios where usuario = ?&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="nv">$usu</span><span class="p">]);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="nv">$usuario</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">if</span><span class="p">(</span><span class="nv">$usuario</span> <span class="o">&amp;&amp;</span> <span class="nb">password_verify</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">],</span> <span class="nv">$usuario</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]))</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">echo</span><span class="s2">&quot;OK!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="k">echo</span><span class="s2">&quot;KO&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>    <span class="p">}</span>
</code></pre></div></p>
<h2 id="5-exercisis">5. Exercisis<a class="headerlink" href="#5-exercisis" title="Permanent link">&para;</a></h2>
<h3 id="bateria-dexercicis-solucionats">Bateria d'exercicis solucionats<a class="headerlink" href="#bateria-dexercicis-solucionats" title="Permanent link">&para;</a></h3>
<h5 id="exercici-1-connexio-basica">Exercici 1. Connexió bàsica<a class="headerlink" href="#exercici-1-connexio-basica" title="Permanent link">&para;</a></h5>
<ol>
<li>Crea un fitxer PHP que faça una connexió a una base de dades MySQL utilitzant PDO.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;mysql:host=db;dbname=pruebadb&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$usuari</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$contrasenya</span> <span class="o">=</span> <span class="s1">&#39;1234&#39;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$usuari</span><span class="p">,</span> <span class="nv">$contrasenya</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Connexió establerta!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">echo</span> <span class="s2">&quot;Error de connexió: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-2-inserir-un-registre">Exercici 2. Inserir un registre<a class="headerlink" href="#exercici-2-inserir-un-registre" title="Permanent link">&para;</a></h5>
<ol>
<li>Escriu una funció que insereixi un nou usuari a la taula <code>users</code> amb el nom i correu electrònic passats per paràmetre.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function inserirUsuari($nom, $correu) {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    global $pdo;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    $sql = &quot;INSERT INTO users (nom, correu) VALUES (:nom, :correu)&quot;;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    $stmt = $pdo-&gt;prepare($sql);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    $stmt-&gt;bindParam(&#39;:nom&#39;, $nom);</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    $stmt-&gt;bindParam(&#39;:correu&#39;, $correu);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">    $stmt-&gt;execute();</span>
<span class="linenos" data-linenos="8 "></span><span class="x">    echo &quot;Usuari inserit!&quot;;</span>
<span class="linenos" data-linenos="9 "></span><span class="x">}</span>
</code></pre></div>

</details>

<h5 id="exericici-3-recuperar-dades">Exericici 3. Recuperar dades<a class="headerlink" href="#exericici-3-recuperar-dades" title="Permanent link">&para;</a></h5>
<ol>
<li>Fes una consulta SQL que mostri tots els usuaris registrats a la taula <code>users</code> i mostra'ls en una taula HTML.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">function</span> <span class="nf">mostrarUsuaris</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">echo</span> <span class="s2">&quot;&lt;table&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">while</span> <span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="nv">$fila</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="nv">$fila</span><span class="p">[</span><span class="s1">&#39;correu&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">echo</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="11 "></span><span class="p">}</span>
</code></pre></div>

</details>

<h5 id="exercici-4-actualitzar-dades">Exercici 4. Actualitzar dades<a class="headerlink" href="#exercici-4-actualitzar-dades" title="Permanent link">&para;</a></h5>
<ol>
<li>Escriu una funció que actualitzi el correu electrònic d'un usuari segons el seu identificador (<code>id</code>).</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">function</span> <span class="nf">actualitzarCorreu</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$nouCorreu</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE users SET correu = :correu WHERE id = :id&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s1">&#39;:correu&#39;</span> <span class="o">=&gt;</span> <span class="nv">$nouCorreu</span><span class="p">,</span> <span class="s1">&#39;:id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Correu actualitzat!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>

</details>

<h5 id="exercici-5-eliminar-un-registre">Exercici 5. Eliminar un registre<a class="headerlink" href="#exercici-5-eliminar-un-registre" title="Permanent link">&para;</a></h5>
<ol>
<li>Implementa un script que esborri un usuari per identificador (<code>id</code>).</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span><span class="k">function</span> <span class="nf">eliminarUsuari</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">global</span> <span class="nv">$pdo</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM users WHERE id = :id&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span>    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s1">&#39;:id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
<span class="linenos" data-linenos="7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Usuari eliminat!&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
</details>

<h5 id="exercici-6-tractament-derrors">Exercici 6. Tractament d'errors<a class="headerlink" href="#exercici-6-tractament-derrors" title="Permanent link">&para;</a></h5>
<ol>
<li>Modifica el codi anterior per gestionar els errors amb <code>try-catch</code> i mostrar missatges d'error clars.</li>
</ol>
<details>
<summary>Solució</summary>

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span> <span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nx">actualitzarCorreu</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;noucorreu@example.com&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>    <span class="k">echo</span> <span class="s2">&quot;Error en actualitzar: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
</details>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2025-2026  Ignasi Gomis,Andrés Martos - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.2 4.2 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.52 8.52 0 0 1-5.33 1.84q-.51 0-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<i.gomismullor@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.13c-.15.01-.29.06-.39.17l-1 1 2.05 2 1-1c.22-.21.22-.56 0-.77l-1.24-1.23a.56.56 0 0 0-.38-.17m-2 1.75L13 19.94V22h2.06l6.06-6.07M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7v-.89l8.24-8.22c.47-.49 1.12-.76 1.8-.76.34 0 .68.06 1 .19V6c0-1.12-.92-2-2.04-2m0 4-8 5-8-5V6l8 5 8-5"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>